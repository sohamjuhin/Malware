#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <netdb.h>

char* get_private_ip() {
    char hostname[256];
    if (gethostname(hostname, sizeof(hostname)) == -1) {
        perror("Error getting hostname");
        return NULL;
    }

    struct hostent* host_entry;
    if ((host_entry = gethostbyname(hostname)) == NULL) {
        perror("Error getting host by name");
        return NULL;
    }

    struct in_addr** address_list = (struct in_addr**)host_entry->h_addr_list;
    char* private_ip = inet_ntoa(*address_list[0]);

    return private_ip;
}

char* get_public_ip() {
    FILE* fp;
    char* response = NULL;
    size_t response_len = 0;
    ssize_t read;

    fp = popen("curl -s http://checkip.dyndns.com/", "r");
    if (fp == NULL) {
        perror("Error executing command");
        return NULL;
    }

    while ((read = getline(&response, &response_len, fp)) != -1) {
        char* address_start = strstr(response, ":") + 2;
        char* address_end = strstr(address_start, "<") - 1;
        *address_end = '\0';
        char* public_ip = strdup(address_start);
        free(response);
        pclose(fp);
        return public_ip;
    }

    perror("Error reading response");
    free(response);
    pclose(fp);
    return NULL;
}

int main() {
    char* private_ip = get_private_ip();
    if (private_ip != NULL) {
        printf("Private IP: %s\n", private_ip);
        free(private_ip);
    }

    char* public_ip = get_public_ip();
    if (public_ip != NULL) {
        printf("Public IP: %s\n", public_ip);
        free(public_ip);
    }

    return 0;
}
